<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="author" content="Severin Meyer">
	<link rel="stylesheet" href="style.css">
	<title>Humble Type Instruction Compiler</title>
</head>
<body>

<header>
	<h1>Humble Type Instruction Compiler</h1>
	<nav>
		<ul>
		<li><a href="index.html">Introduction</a>
		<li><a href="instructions.html">Instructions</a>
		<li><a href="blocks.html">Blocks</a>
		<li><a href="example.html">Example</a>
		<li><a href="grammar.html" id="current">Grammar</a>
		<li><a href="usage.html">Usage</a>
		</ul>
	</nav>
</header>

<main>
	<h2>Grammar</h2>
	<p>
		The following
		<a target="_blank" href="http://en.wikipedia.org/wiki/ABNF">ABNF</a>
		grammar describes the compiler input format.
		In addition to the official grammar syntax, single quotes denote case sensitive strings.
	</p>

<div>
	<h3 id="main">Main structure</h3>
	<table class="grammar">
		<tr>
			<td class="rule">root</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>[</em>flags<em>]</em> <em>[</em>gasp<em>]</em> <em>[</em>maxp<em>]</em> <em>[</em>cvt<em>]</em> <em>[</em>fpgm<em>]</em> <em>[</em>prep<em>] *</em>glyph</td>
		</tr>
		<tr>
			<td class="rule">gasp</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>gasp</b><em>'</em> open <em>*(</em>ws uint <em>[</em>s&nbsp;<em>'</em><b>gridfit</b><em>'] [</em>s&nbsp;<em>'</em><b>gray</b><em>']</em>&nbsp;nl<em>)</em> close</td>
		</tr>
		<tr>
			<td class="rule">maxp</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>maxp</b><em>'</em> open <em>*(</em>ws uint s maxpname nl<em>)</em> close</td>
		</tr>
		<tr>
			<td class="rule">cvt</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>cvt</b><em>'</em> open <em>*(</em>ws&nbsp;num&nbsp;s&nbsp;id&nbsp;nl<em>)</em> close</td>
		</tr>
		<tr>
			<td class="rule">flags</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>flags</b><em>'</em> open <em>*(</em>ws&nbsp;id&nbsp;s&nbsp;bits&nbsp;nl<em>)</em> close</td>
		</tr>
		<tr>
			<td class="rule">fpgm</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>fpgm</b><em>'</em> block</td>
		</tr>
		<tr>
			<td class="rule">prep</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>prep</b><em>'</em> block</td>
		</tr>
		<tr>
			<td class="rule">glyph</td>
			<td class="equal"><em>=</em></td>
			<td class="def">id block</td>
		</tr>
	</table>
</div>

<div>
	<h3 id="block">Block Structure</h3>
	<table class="grammar">
		<tr>
			<td class="rule">block</td>
			<td class="equal"><em>=</em></td>
			<td class="def">open <em>*(</em>block&nbsp;<em>/ (</em>ws&nbsp;instr&nbsp;nl<em>))</em> close</td>
		</tr>
		<tr>
			<td class="rule">open</td>
			<td class="equal"><em>=</em></td>
			<td class="def">ws <em>'</em><b>{</b><em>'</em> ws</td>
		</tr>
		<tr>
			<td class="rule">close</td>
			<td class="equal"><em>=</em></td>
			<td class="def">ws <em>'</em><b>}</b><em>'</em> ws</td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
			<td class="rule">instr</td>
			<td class="equal"><em>=</em></td>
			<td class="def">instrname flag <em>*(</em>s&nbsp;arg<em>)</em></td>
		</tr>
		<tr>
			<td class="rule">flag</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>['</em><b>[</b><em>'</em>&nbsp;flagval&nbsp;<em>'</em><b>]</b><em>'</em>&nbsp;<em>/ '</em><b>+</b><em>'</em>&nbsp;flagval<em>]</em></td>
		</tr>
		<tr>
			<td class="rule">flagval</td>
			<td class="equal"><em>=</em></td>
			<td class="def">id&nbsp;<em>/</em> bits</td>
		</tr>
		<tr>
			<td class="rule">arg</td>
			<td class="equal"><em>=</em></td>
			<td class="def">id&nbsp;<em>/</em> val</td>
		</tr>
		<tr>
			<td class="rule">val</td>
			<td class="equal"><em>=</em></td>
			<td class="def">num&nbsp;<em>/ '</em><b>(</b><em>'&nbsp;(</em>instr&nbsp;<em>/</em> operation<em>)&nbsp;'</em><b>)</b><em>'</em></td>
		</tr>
		<tr>
			<td class="rule">operation</td>
			<td class="equal"><em>=</em></td>
			<td class="def">val s operator s val</td>
		</tr>
	</table>
</div>

<div>
	<h3 id="terminals">Terminals</h3>
	<table class="grammar">
		<tr>
			<td class="rule">s</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>1*</em>WSP <small>;Mandatory&nbsp;space</small></td>
		</tr>
		<tr>
			<td class="rule">nl</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>*(</em>LWSP&nbsp;<em>/</em> comment<em>)</em> CRLF <small>;Mandatory&nbsp;newline</small></td>
		</tr>
		<tr>
			<td class="rule">ws</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>*(</em>LWSP&nbsp;<em>/</em> comment CRLF<em>)</em> <small>;Optional&nbsp;whitespace</small></td>
		</tr>
		<tr>
			<td class="rule">comment</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>#</b><em>' *(</em>VCHAR&nbsp;<em>/</em> WSP<em>)</em></td>
		</tr>
		<tr><td colspan="3">&nbsp;</td></tr>
		<tr>
			<td class="rule">id</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>1*(</em>ALPHA&nbsp;<em>/</em> DIGIT&nbsp;<em>/ '</em><b>_</b><em>'&nbsp;/ '</em><b>.</b><em>')</em></td>
		</tr>
		<tr>
			<td class="rule">instrname</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>&lt;</em>TrueType instruction name<em>&gt;</em></td>
		</tr>
		<tr><td colspan="3">&nbsp;</td></tr>
		<tr>
			<td class="rule">num</td>
			<td class="equal"><em>=</em></td>
			<td class="def">xint&nbsp;<em>/</em> bint&nbsp;<em>/</em> int&nbsp;<em>/</em> f26d6&nbsp;<em>/</em> f2d14</td>
		</tr>
		<tr>
			<td class="rule">xint</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>0x</b><em>'&nbsp;1*4</em>HEXDIG</td>
		</tr>
		<tr>
			<td class="rule">bint</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>0b</b><em>'&nbsp;1*16</em>BIT</td>
		</tr>
		<tr>
			<td class="rule">int</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>&lt;</em><b>-32768</b>&nbsp;to <b>32767</b><em>&gt;</em></td>
		</tr>
		<tr>
			<td class="rule">f26d6</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>&lt;</em><b>-512.0</b>&nbsp;to <b>511.984375</b><em>&gt;</em></td>
		</tr>
		<tr>
			<td class="rule">f2d14</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>&lt;</em><b>-2:0</b>&nbsp;to <b>1:999938965</b><em>&gt;</em></td>
		</tr>
		<tr><td colspan="3">&nbsp;</td></tr>
		<tr>
			<td class="rule">bits</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>1*5</em>BIT</td>
		</tr>
		<tr>
			<td class="rule">uint</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>%d</em><b>0</b>-<b>65535</b></td>
		</tr>
		<tr>
			<td class="rule">delta</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>%d</em><b>0</b>-<b>32767</b> <em>('</em><b>+</b><em>'&nbsp;/&nbsp;'</em><b>-</b><em>') %d</em><b>1</b>-<b>8</b></td>
		</tr>
		<tr><td colspan="3">&nbsp;</td></tr>
		<tr>
			<td class="rule">operator</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>==</b><em>'&nbsp;/ '</em><b>!=</b><em>'&nbsp;/ '</em><b>&gt;</b><em>'&nbsp;&nbsp;/ '</em><b>&gt;=</b><em>'&nbsp;/ '</em><b>&lt;</b><em>'&nbsp;&nbsp;/ '</em><b>&lt;=</b><em>'&nbsp;/ '</em><b>+</b><em>'&nbsp;&nbsp;/ '</em><b>-</b><em>'&nbsp;&nbsp;/ '</em><b>*</b><em>'&nbsp;&nbsp;/ '</em><b>/</b><em>'&nbsp;&nbsp;/ '</em><b>or</b><em>'&nbsp;/ '</em><b>and</b><em>'</em></td>
		</tr>
		<tr><td colspan="3">&nbsp;</td></tr>
		<tr>
			<td class="rule">maxpname</td>
			<td class="equal"><em>=</em></td>
			<td class="def"><em>'</em><b>maxZones</b><em>'&nbsp;/<br>'</em><b>maxTwilightPoints</b><em>'&nbsp;/<br>'</em><b>maxStorage</b><em>'&nbsp;/<br>'</em><b>maxFunctionDefs</b><em>'&nbsp;/<br>'</em><b>maxStackElements</b><em>'</em></td>
		</tr>
	</table>
</div>

<div>
	<h3 id="altered">Altered Instructions</h3>
	<p>
		These instructions differ from the TrueType specification,
		for example because they use alphanumeric identifiers instead of indices.
	</p>
	<table class="grammar">
		<tr>
			<td class="rule">instr</td>
			<td class="equal"><em>=/</em></td>
			<td class="def"><em>'</em><b>MIAP</b><em>'</em> flag s val s id</td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>MIRP</b><em>'</em> flag s val s id</td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>WCVTP</b><em>'</em> s id s val</td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>WCVTF</b><em>'</em> s id s val</td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>RCVT</b><em>'</em>&nbsp; s id</td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>WS</b><em>'</em> s id s val</td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>RS</b><em>'</em> s id</td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td><em>'</em><b>FDEF</b><em>'</em> s id</td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>CALL</b><em>'</em> s id <em>*(</em>s&nbsp;val<em>)</em></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>LOOPCALL</b><em>'</em> s val s id <em>*(</em>s&nbsp;val<em>)</em></td>
		</tr>
	</table>
</div>

<div>
	<h3 id="custom">Custom Instructions</h3>
	<table class="grammar">

		<tr>
			<td class="rule">instr</td>
			<td class="equal"><em>=/</em></td>
			<td><em>'</em><b>void</b><em>'</em> s id</td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>push</b><em>' 1*(</em>s num<em>)</em></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>deltac</b><em>'</em> s id&nbsp; <em>1*(</em>s&nbsp;delta<em>)</em></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>'</em><b>deltap</b><em>'</em> s val <em>1*(</em>s&nbsp;delta<em>)</em></td>
		</tr>
	</table>
</div>

<div>
	<h3 id="unsupported">Unsupported Instructions</h3>
	<p>
		As an extension to the ABNF, <code>!=</code> shall remove alternatives from a rule.
	</p>
	<table class="grammar">
		<tr>
			<td class="rule">instr</td>
			<td class="equal"><em>!=</em></td>
			<td class="def"><em>&lt;</em><b>AA</b>.*<em>&gt;</em>&nbsp;&nbsp;&nbsp; <small>;Deprecated</small></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>&lt;</em><b>SANGW</b>.*<em>&gt;</em> <small>;Deprecated</small></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>&lt;</em><b>IDEF</b>.*<em>&gt;</em>&nbsp; <small>;Cannot handle custom instructions</small></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>&lt;</em><b>DELTAC</b>[<b>123</b>].*<em>&gt;</em> <small>;Use <b>deltac</b> instead</small></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>&lt;</em><b>DELTAP</b>[<b>123</b>].*<em>&gt;</em> <small>;Use <b>deltap</b> instead</small></td>
		</tr>
		<tr>
			<td class="rule"></td>
			<td class="equal"><em>&nbsp;/</em></td>
			<td class="def"><em>&lt;</em><b>N</b>?<b>PUSH</b>[<b>BW</b>]?.*<em>&gt;</em> <small>;Use <b>push</b> instead</small></td>
		</tr>
	</table>
</div>
</main>

<footer>
	This documentation by
	<a target="_blank" href="http://gitlab.com/u/sev">Severin Meyer</a>
	is licensed under the
	<a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
</footer>

</body>
</html>
