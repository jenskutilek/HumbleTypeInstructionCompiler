<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="author" content="Severin Meyer">
	<link rel="stylesheet" href="style.css">
	<title>Humble Type Instruction Compiler</title>
</head>
<body>

<header>
	<h1>Humble Type Instruction Compiler</h1>
	<nav>
		<ul>
		<li><a href="index.html">Introduction</a>
		<li><a href="instructions.html" id="current">Instructions</a>
		<li><a href="blocks.html">Blocks</a>
		<li><a href="example.html">Example</a>
		<li><a href="grammar.html">Grammar</a>
		<li><a href="usage.html">Usage</a>
		</ul>
	</nav>
</header>

<main>
	<h2>Instructions</h2>
	<p>
		The aim of humble type instructions is to simplify the arrangement
		of TrueType instruction names, flags, and arguments.
	</p>

<div id="comments">
	<h3>Comments</h3>
	<p>
		Text between <code>#</code> and the end of the line is ignored.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>RTG <strong>#</strong> Hello</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>RTG</samp></pre></td>
		</tr>
	</table>
</div>

<div id="flags">
	<h3>Flags</h3>
	<p>
		Instruction flags can be written in binary or
		<a href="blocks.html#flags">alias</a> form.
		They follow the instruction name in square brackets,
		or separated by a <code>+</code> character. Flags with a value of zero can be omitted.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>MIRP[<strong>01101</strong>]<br>MIRP+<strong>stem</strong><br>MIRP</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>MIRP[<strong>01101</strong>]<br>MIRP[<strong>01101</strong>]<br>MIRP[<strong>00000</strong>]</samp></pre></td>
		</tr>
	</table>
</div>

<div id="arguments">
	<h3>Arguments</h3>
	<p>
		Instruction arguments are listed after the instruction name,
		on the same line, separated by at least one space.
		The compiler then creates optimized push instructions.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>ALIGNPTS <strong>7 8</strong><br>FLIPPT <strong>9</strong></code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[010]<br> <strong>9<br> 7<br> 8</strong><br>ALIGNPTS<br>FLIPPT</samp></pre></td>
		</tr>
	</table>
</div>

<div id="loops">
	<h3>Automatic Looping</h3>
	<p>
		If more than one argument follows an <code>ALIGNRP</code>, <code>FLIPPT</code>, <code>IP</code>, or <code>SHP</code> instruction,
		the compiler will split them up appropriatly, either by multiplying the instruction or by inserting <code>SLOOP</code>.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>ALIGNRP <strong>6 7 8 9</strong></code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[100]<br><strong> 6<br> 7<br> 8<br> 9</strong><br> 4<br>SLOOP<br>ALIGNRP</samp></pre></td>
		</tr>
	</table>
</div>

<div id="conversion">
	<h3>Numeric Conversion</h3>
	<p>
		Numeric arguments can be written in different formats. The compiler supports
		the hexadecimal notation with a <code>0x</code> prefix,
		the binary notation with a <code>0b</code> prefix,
		signed integers, signed decimals representing f26dot6,
		or signed decimals with a colon representing f2dot14.
		Decimals are rounded when necessary.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>SMD <strong>0x60</strong><br>SMD <strong>0b1100000</strong><br>SMD <strong>96</strong><br>SMD <strong>1.5</strong><br>SMD <strong>0:005859375</strong></code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[000]<br> <strong>96</strong><br>SMD</samp></pre></td>
		</tr>
	</table>
</div>

<div id="identifiers">
	<h3>Identifiers</h3>
	<p>
		Unique names are used to address control values, storage locations, or functions.
		The compiler takes care of mapping each name to an index.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>WS <strong>foo</strong> 8</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[001]<br> <strong>17</strong><br> 8<br>WS</samp></pre></td>
		</tr>
	</table>
</div>

<div id="nested">
	<h3>Nested Instructions</h3>
	<p>
		To use the output of an instruction as an argument, it is nested in parentheses.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>MIAP <strong>(</strong>RS foo<strong>)</strong> bar</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp><strong>PUSHB[000]<br> 17<br>RS</strong><br>PUSHB[000]<br> 23<br>MIAP[0]</samp></pre></td>
		</tr>
	</table>
</div>

<div id="operators">
	<h3>Operator Symbols</h3>
	<p>
		Instead of writing mathematical instructions in prefix notation,
		it is possible to write their symbols
		<code>==</code> <code>!=</code> <code>&lt;=</code> <code>&lt;</code>
		<code>&gt;=</code> <code>&gt;</code> <code>+</code> <code>-</code>
		<code>*</code> <code>/</code> <code>and</code> <code>or</code>
		between their two arguments. When possible, nested instructions
		should be placed on the right side, for an optimal push optimization.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>IF (2 <strong>></strong> (1 <strong>+</strong> 3))</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[010]<br> 2<br> 1<br> 3<br><strong>ADD<br>GT</strong><br>IF</samp></pre></td>
		</tr>
	</table>
</div>

<div id="functions">
	<h3>Function Definitions</h3>
	<p>
		The <code>FDEF</code> instruction is more verbose.
		Its first argument is the function index, followed by the function identifier.
		Then follows a list of expected parameters, which are used to parse
		the arguments of the corresponding <code>CALL</code> instructions.
		A parameter must begin with
		<code>val</code>, <code>pt</code>, <code>cvt</code>, <code>func</code>, or <code>stor</code>
		to declare its type, which is either a numerical value,
		point number, control value identifier, function identifier, or storage identifier respectively.
		Additional characters can be appended to a parameter name.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>FDEF <strong>9 interpolate pt pt1 pt2</strong><br>  SRP2<br>  SRP1<br>  DUP<br>  IP<br>  MDAP[rnd]<br>ENDF</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[000]<br>  <strong>9</strong><br>FDEF<br>  SRP2<br>  SRP1<br>  DUP<br>  IP<br>  MDAP[rnd]<br>ENDF<br></samp></pre></td>
		</tr>
	</table>
</div>

<div id="stack">
	<h3>Stack Management</h3>
	<p>
		When arguments are listed after the instruction name,
		the compiler creates optimized <code>PUSH</code> instructions.
		However, sometimes it is desireable to manage
		the stack manually, for example in function definitions.
		For that case, it is possible to omit arguments after
		an instruction and instead push them with the custom <code>push</code> instruction.
		Mixing automatic and manual pushes within
		the same scope, e.g. the body of a function definition, is not recommended.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>FDEF 31 align pt<br>  DUP<br>  <strong>push 1</strong><br>  ADD<br>  ALIGNPTS<br>ENDF</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[000]<br> 31<br>FDEF<br>DUP<br><strong>PUSHB[000]<br> 1</strong><br>ADD<br>ALIGNPTS<br>ENDF</samp></pre></td>
		</tr>
	</table>
</div>

<div id="calls">
	<h3>Function Calls</h3>
	<p>
		Function calls are slightly rearranged.
		The possible loop count and identifier of the function are listed first, followed by the arguments.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>CALL align <strong>8</strong><br>LOOPCALL 2 align <strong>8 6</strong></code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[001]<br> <strong>8</strong><br> 31<br>CALL<br>PUSHB[011]<br> <strong>8<br> 6</strong><br> 2<br> 31<br>LOOPCALL</samp></pre></td>
		</tr>
	</table>
</div>

<div id="void">
	<h3>Void Functions</h3>
	<p>
		Because functions can potentially push values onto the stack,
		the compiler normally does not consolidate push instruction accross <code>CALL</code> instructions.
		However, if a function does not push more values than it consumes, it can
		be declared with the <code>void</code> instruction instead of <code>FDEF</code>,
		to enable a more aggressive optimization.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code><strong>void</strong> align</code></pre></td>
		<td class="to">&nbsp;</td>
		<td class="out">&nbsp;</td>
		</tr>
	</table>
</div>

<div id="delta">
	<h3>Delta Instructions</h3>
	<p>
		The standard <a target="_blank" href="http://developer.apple.com/fonts/TrueType-Reference-Manual/RM02/Chap2.html#size">DELTA</a>
		instructions are replaced by the custom <code>deltac</code> and <code>deltap</code> instructions.
		Their arguments consist of a control value identifier or a point number, followed by a sequence of modifiers.
		Each modifier consists of a ppem value and a signed step value.
		For example, the modifier <code>29-6</code> causes a shift of -6 steps at a ppem of 29.
		The compiler generates appropriate <code>SDB</code> and <code>DELTA*</code> instructions.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>deltap 8 <strong>11+2 29-6</strong></code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[110]<br> <strong>34</strong><br> 8<br> 1<br> <strong>9</strong><br> 8<br> 1<br> 11<br>SDB<br>DELTAP1<br>DELTAP2</samp></pre></td>
		</tr>
	</table>
</div>

<div id="subblock">
	<h3>Subblocks</h3>
	<p>
		A subblock suspends the current argument consolidation and starts a new one within its scope.
		It can be used to limit the number of arguments pushed at once, thus avoiding the infamous stack overflow.
		Subblocks are enclosed with <code>{}</code>.
	</p>
	<table class="code">
		<tr>
		<td class="in"><pre><code>UTP 1<br>UTP 2<br><strong>{<br>  UTP 3<br>  UTP 4<br>}</strong><br>UTP 5</code></pre></td>
		<td class="to">▶</td>
		<td class="out"><pre><samp>PUSHB[010]<br> 5<br> 2<br> 1<br>UTP<br>UTP<br><strong>PUSHB[001]<br> 4<br> 3<br>UTP<br>UTP</strong><br>UTP</samp></pre></td>
		</tr>
	</table>
</div>
</main>

<footer>
	This documentation by
	<a target="_blank" href="http://gitlab.com/u/sev">Severin Meyer</a>
	is licensed under the
	<a target="_blank" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
</footer>

</body>
</html>
